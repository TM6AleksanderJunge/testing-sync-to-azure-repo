name: Push directory to another repository
on: push
jobs:
  sync-to-azure:
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/syncing-branch'
    steps:
    - uses: actions/checkout@v2
    - name: sync to azure
      env:
        AZREPO: "AzureRepos-syncing"
        AZPAT: ${{secrets.AZUREPAT}}
        AZUSERNAME: "s223125"
        AZUSER_EMAIL: "s223125@dtu.dk"
        AZORG: "s223125"
      shell: bash
      run: |
         git config --global user.email "$AZUSER_EMAIL"
         git config --global user.name "$AZUSERNAME"
         git remote set-url --add --push origin https://$AZUSERNAME:$AZPAT@dev.azure.com/$AZORG/syncing-test/_git/$AZREPO
         git fetch --unshallow origin
         git add .
         git commit -m "sync from git to azure"
         git push origin syncing-branch:arrival-branch --force
